(function(){this.SimpleVast=function(){function a(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return h="simple VAST",a?(a.dbg&&console.log(""+h+": inited!"),o=this,m=0,n={adTitle:null,impression:null,videoUrl:null,clickUrl:null,duration:null,customViewTracker:null,clickUrl:null,trackers:[]},d=["firstQuartile","midpoint","thirdQuartile","complete","mute","unmute","rewind","pause","resume","fullscreen","creativeView","acceptInvitation","start","complete"],this.getAd=function(a){return o.completeCallback=a,l(),g()},this.trackEvent=function(b){var c,d,e,f,g;if(d=n.trackers[b],d&&d.length){for(g=[],e=0,f=d.length;f>e;e++)c=d[e],a.dbg&&console.log(""+h+": track "+b+" url: "+c),g.push(k(c,""));return g}},this.trackUrl=function(a){return k(a,"")},g=function(){var b;return b=f(),b?(a.dbg&&console.log(""+h+": try get tag â„–"+m+" "+b.url),e(b.url,function(){return function(a){var c;return a?(c=j(b,a),c?o.completeCallback(c):g()):g()}}(this))):o.completeCallback(null)},j=function(d,e){var f,g;switch(a.dbg&&console.log(""+h+": search parser for "+d.provider),d.provider.toLowerCase()){case"adfox":g=b;break;case"openx":g=i;break;case"dfp":g=c;break;default:a.dbg&&console.log(""+h+": unknown parser for "+d.provider)}return f=g(e)},f=function(){return a.dbg&&console.log("............ \n"+h+": check if tag exists"),m++,a.vastTags[m-1]?a.vastTags[m-1]:(a.dbg&&console.log(""+h+": no more tags"),!1)},l=function(){return n={adTitle:null,impression:null,videoUrl:null,clickUrl:null,duration:null,customViewTracker:null,clickUrl:null,trackers:[]}},c=function(b){var c,e,f,g,i,j,k,l,m;a.dbg&&console.log(""+h+": try parse dfpParser node");try{if(!b.querySelector("Ad"))return a.dbg&&console.log(""+h+": VAST response is empty"),!1;for(i=b.querySelector("TrackingEvents"),n.adTitle=b.querySelector("AdTitle").childNodes[0]?b.querySelector("AdTitle").childNodes[0].data:null,n.impression=b.querySelector("Impression").childNodes[0]?b.querySelector("Impression").childNodes[0].data:null,n.videoUrl=b.querySelector("MediaFiles>MediaFile").childNodes[0]?b.querySelector("MediaFiles>MediaFile").childNodes[0].data:null,n.duration=b.querySelector("Creative Duration").innerHTML?b.querySelector("Creative Duration").innerHTML:null,n.customViewTracker=b.querySelector("#secondaryAdServer")?b.querySelector("#secondaryAdServer").childNodes[0].data:null,n.clickUrl=b.querySelector("VideoClicks ClickThrough")?b.querySelector("VideoClicks ClickThrough").childNodes[0].data:null,j=0,l=d.length;l>j;j++)for(g=d[j],f=i.querySelectorAll("[event='"+g+"']"),k=0,m=f.length;m>k;k++)e=f[k],n.trackers[g]||(n.trackers[g]=[]),n.trackers[g].push(e.childNodes[0].data);return n}catch(o){return c=o,a.dbg&&console.error(""+h+": parser crashed!"),console.log(c)}},i=function(b){var c,e,f,g,i,j;a.dbg&&console.log(""+h+": try parse openxParser node");try{if(!b.querySelector("Ad"))return a.dbg&&console.log(""+h+": VAST response is empty"),!1;for(g=b.querySelector("TrackingEvents"),n.clickUrl=b.querySelector("ClickThrough URL")?b.querySelector("ClickThrough URL").childNodes[0].data:null,n.adTitle=b.querySelector("AdTitle").childNodes[0].data,n.impression=b.querySelector("#primaryAdServer").childNodes[0].data,n.videoUrl=b.querySelector("MediaFile>URL").childNodes[0].data,n.duration=b.querySelector("Video>Duration").innerHTML,n.customViewTracker=b.querySelector("#secondaryAdServer")?b.querySelector("#secondaryAdServer").childNodes[0].data:null,i=0,j=d.length;j>i;i++)f=d[i],e=g.querySelector("[event='"+f+"']"),e&&e.querySelector&&(n.trackers[f]=[e.querySelector("URL").childNodes[0].data],"start"===d[f]&&n.customViewTracker&&n.trackers[f].push(n.customViewTracker));return n}catch(k){if(c=k,a.dbg)return console.error(""+h+": parser crashed!")}},b=function(b){var c,e,f,g,i,j,k,l,m;a.dbg&&console.log(""+h+": try parse adfoxXML node");try{if(!b.querySelector("Ad"))return a.dbg&&console.log(""+h+": VAST response is empty"),!1;for(i=b.querySelector("TrackingEvents"),n.adTitle=b.querySelector("AdTitle").childNodes[0]?b.querySelector("AdTitle").childNodes[0]:"no title",n.impression=b.querySelector("Impression").childNodes[0].data,n.videoUrl=b.querySelector("MediaFiles MediaFile").childNodes[1].data,n.duration=b.querySelector("Duration").innerHTML,n.customViewTracker=b.querySelector("#secondaryAdServer")?b.querySelector("#secondaryAdServer").childNodes[0].data:null,n.clickUrl=b.querySelector("VideoClicks ClickThrough")?b.querySelector("VideoClicks ClickThrough").childNodes[0].data:null,j=0,l=d.length;l>j;j++)for(g=d[j],f=i.querySelectorAll("[event='"+g+"']"),k=0,m=f.length;m>k;k++)e=f[k],n.trackers[g]||(n.trackers[g]=[]),n.trackers[g].push(e.childNodes[0].data);return n}catch(o){if(c=o,a.dbg)return console.error(""+h+": parser crashed!")}},e=function(b,c){var d;return d=new XMLHttpRequest,d.withCredentials=!0,d.open("GET",b,!0),d.onreadystatechange=function(){var b;if(4===d.readyState){if(200!==d.status)return a.dbg&&console.log(""+h+": response error"),c(null);try{return c(this.responseXML.documentElement)}catch(e){return b=e,a.dbg&&console.log(""+h+": unknown response"),c(null)}}},d.send()},void(k=function(a,b){var c;return c=new Image,c.src=a+b+"&rand="+(new Date).getTime()})):(console.log(""+h+" options undefined!"),!1)}return a}()}).call(this);